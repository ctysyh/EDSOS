# Helios Sync：基于光脉冲的全局时钟同步与控制信令系统

版本：1.0
作者：Bib Guake
日期：2025年12月22日
适用场景：单楼栋内固定部署的 DPU 互联集群（含临时小规模部署）

---

## 1. 概述

Helios Sync 是一种利用**可见光脉冲**作为全局同步与轻量控制信令的物理层机制。其核心思想是：**在静态、视距可达的部署环境中，利用光速恒定与几何路径可测的特性，将时钟同步问题转化为离线标定问题**。

系统仅需一个主光源（可为专用 LED 灯或集成于照明系统），通过直射或镜面反射覆盖所有 DPU 节点。每个 DPU 集成微型光敏传感器，用于检测光脉冲并触发本地时钟对齐或状态响应。

该方案兼具**超低延迟、零布线成本、高鲁棒性与多用途扩展能力**，特别适用于以“内存总线外延”为核心的 DPU 互联架构。

---

## 2. 系统组成

### 2.1 光源（Light Emitter）
- **类型**：高亮度白光 LED 或红外 LED（人眼不可见）
- **位置**：固定安装
- **输出能力**：
  - 脉冲上升时间 < 10 ns
  - 支持频率调制（1 Hz – 10 kHz）
  - 可编程闪烁序列（编码信息）
- **安全约束**：
  - 最小脉冲间隔 ≤ 1000 ms

> **安全设计原则**：任何物理变更（如更换/调整镜子）所需要的最小时间必须覆盖多个脉冲周期，以切实捕捉外在条件变化，防止物理安全问题（例如入室犯罪）。

### 2.2 反射镜（Passive Mirrors）
- **材质**：高反射率平面镜（镀铝或介质膜）
- **作用**：绕过机柜遮挡，扩展覆盖范围
- **关键特性**：
  - 无源、无延迟、无需供电
  - 每面镜子位置在部署时记录
- **路径建模**：每条光路（直射或经 N 次反射）视为独立传播通道，总距离 = ∑ 各段几何长度

### 2.3 DPU 光敏单元（Opto-Sync Block）
集成于 DPU ASIC 封装内，包含：
- 光电二极管（PD） + 跨阻放大器（TIA）
- 带通滤波器（中心频率可配置）
- 边沿检测器 + 数字解码器
- 可编程延迟补偿单元（Delay Line）
- 状态机控制器

---

## 3. 部署与标定流程

### 3.1 静态拓扑标定（一次性）
1. 固定所有 DPU 机柜与反射镜位置。
2. 使用激光测距仪测量**每台 DPU 到光源的每条有效光路总长度** \( L_i \)（单位：米）。
3. 计算理论传播延迟：
   \[
   \Delta t_i = \frac{L_i}{c} \quad (c = 3 \times 10^8  \text{m/s})
   \]
4. 将 \( \Delta t_i \) 写入 DPU 的非易失存储器（eFUSE/OTP）。
5. DPU 上电后自动加载该值，配置内部 delay line。

> 效果：所有 DPU 在接收到同一光脉冲后，**本地时钟对齐误差 < 1 ns**（仅剩器件 jitter）。

### 3.2 动态校准（可选）
- 每 10–100 ms 发射一次同步脉冲，用于补偿晶振 drift。
- 若长期 drift 超限（>10 ns），触发告警。

---

## 4. 同步与信令协议

### 4.1 基础同步模式
- **脉冲特征**：1 kHz 方波，持续 1 ms（即 1 个周期）
- **触发动作**：
  - 锁存本地时钟相位
  - 重置 PLL/CDR 环路滤波器
  - 更新全局时间戳（用于日志、快照等）

### 4.2 鲁棒性保障：频率验证
- 仅当检测到**连续 3 个周期**符合预设频率（如 1 kHz ± 1%）时，才视为有效同步事件。
- 防止环境光（日光、荧光灯）误触发。

### 4.3 多用途信令编码
通过改变闪烁频率或序列，传递控制指令：

| 频率 / 模式        | 含义               | 响应行为 |
|--------------------|--------------------|--------|
| 1 Hz（慢闪）       | 系统休眠           | DPU 进入低功耗模式 |
| 10 Hz              | 正常运行           | 维持当前状态 |
| 100 Hz             | 高负载提示         | XPU 提前预热、缓存预取 |
| 1 kHz（标准同步）  | 时钟对齐           | 执行同步动作 |
| 5 kHz + 10 ms burst| 紧急关机           | 安全 flush 内存、断电 |
| 特定伪随机序列     | 固件更新触发       | 进入 bootloader |

> **编码原则**：所有频率均 >200 Hz（人眼不可感知），避免干扰工作环境。

---

## 5. 小规模临时部署支持

针对实验室、演示、边缘临时集群（≤8 节点）：

### 5.1 手机 APP 功能
- 名称：**Helios Mobile**
- 平台：iOS / Android
- 功能：
  - 关闭屏幕（减少环境光干扰）
  - 控制手机闪光灯按指定频率闪烁
  - 选择预设模式（Sync / Sleep / Boot）
  - 显示当前 DPU 响应状态（通过蓝牙/WiFi 回传）

### 5.2 使用流程
1. 用户将房间熄灯，手机距离 DPU ≥1 米（避免近场饱和）。
2. 打开 APP，选择“临时同步”。
3. APP 操作手机闪光灯发射脉冲，完成初始化对齐。
4. 后续可通过 APP 发送控制指令。

> 零硬件成本、快速部署、适合 PoC 验证。

---

## 6. 安全与可靠性设计

| 风险 | 缓解措施 |
|------|--------|
| 镜子意外移动 | DPU 监测信号幅度突变并告警 |
| 光源失效 | 可选备用光源（如第二盏灯）；DPU 在 N 次 missed sync 后降级为本地晶振模式 |
| 恶意光干扰 | 频率+序列双重验证；仅接受预注册编码 |
| 环境光噪声 | 带通滤波 + 数字相关检测；阈值自适应 |

---

## 7. 性能指标

| 指标 | 目标值 |
|------|-------|
| 同步精度（标定后） | < 1 ns RMS |
| 覆盖半径 | ≥ 50 m（配合镜子） |
| 最大节点数 | 无理论限制（广播性质） |
| 功耗（DPU 端） | < 200 μW |
| 部署标定时间 | < 5 分钟/机柜 |

---

## 8. 总结

Helios Sync 将**物理世界的确定性**（光速恒定、位置固定）转化为**系统设计的简化性**，实现了：

- **零电缆全局同步**
- **天然广播、无限扩展**
- **多用途控制信令**
- **极致低成本与高鲁棒性**

它不仅是时钟同步方案，更是**“物理即接口”**（Physics-as-an-API）理念的工程实践，为未来去中心化、确定性互联架构提供了优雅基础。

---

**附录 A**：典型部署示意图（略）  
**附录 B**：Opto-Sync Block RTL 接口定义（略）  
**附录 C**：Helios Mobile APP UI 原型（略）